<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rocket Run Pro: Mestre do Espa√ßo</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        /* Estilos b√°sicos para centralizar o canvas e torn√°-lo responsivo (MANTIDO) */
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #0a0014;
            font-family: Arial, sans-serif;
            color: white;
            overflow: hidden; /* Evita barras de rolagem desnecess√°rias */
            /* IMPORTANTE: Adiciona 'position: relative' ao body para posicionar os bot√µes */
            position: relative; 
        }
        canvas {
            display: block;
            border-radius: 12px;
            box-shadow: 0 0 30px rgba(255, 50, 50, 0.5); /* Efeito neon vermelho */
            cursor: pointer;
        }

        /* Estilos do Menu e Game Over (MANTIDO) */
        .menu-container, .game-over-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 30px;
            background: rgba(0, 0, 0, 0.85);
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
            text-align: center;
            z-index: 100;
        }

        .menu-container h1, .game-over-container h1 { color: #ff9900; margin-bottom: 25px; font-size: 2.5rem; }
        .difficulty-button, .restart-button { display: block; width: 250px; padding: 15px 20px; margin: 15px auto; border: none; border-radius: 8px; font-size: 1.2rem; font-weight: bold; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
        .difficulty-button:hover, .restart-button:hover { transform: translateY(-3px); box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3); }
        .easy { background-color: #00A389; color: white; } 
        .medium { background-color: #ffc107; color: #333; } 
        .insane { background-color: #F44336; color: white; } 
        .game-over-container h2 { color: #F44336; margin: 15px 0; font-size: 1.8rem; }
        .score-display { font-size: 1.4rem; color: #ccc; margin-bottom: 20px; }
        .score-display span { color: #ffc107; font-size: 1.8rem; font-weight: bold; }
        .hidden { display: none; }
        #controls-instruction {
            position: absolute;
            bottom: 5px; /* Mais para baixo para n√£o cobrir o D-Pad */
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.8rem; /* Menor para economizar espa√ßo */
            z-index: 10;
        }
        
        /* NOVO: Estilos para o D-Pad (Controles M√≥veis) */
        #mobile-controls {
            position: absolute;
            bottom: 10px;
            left: 10px;
            z-index: 20; /* Fica acima de tudo */
            display: none; /* Inicialmente oculto. Exibido apenas no jogo */
        }
        
        .control-button {
            width: 55px;
            height: 55px;
            margin: 5px;
            border: 3px solid #ff9900;
            border-radius: 50%;
            background-color: rgba(255, 153, 0, 0.3);
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            line-height: 50px;
            user-select: none; /* Evita sele√ß√£o de texto no toque */
            touch-action: manipulation; /* Melhora a resposta no touch */
            cursor: pointer;
            transition: background-color 0.1s;
        }

        .control-button:active {
            background-color: rgba(255, 153, 0, 0.8);
            box-shadow: 0 0 10px #ff9900;
        }

        #left-button { float: left; }
        #right-button { float: left; margin-left: 0; } /* Alinha com o bot√£o 'left' */
        #up-button { clear: both; margin: 5px auto; display: block; width: 125px; border-radius: 8px; height: 35px; line-height: 30px; font-size: 1.2rem; }
        
        /* NOVO: Classe para for√ßar a exibi√ß√£o do D-Pad */
        .show-mobile-controls { display: block !important; }

    </style>
</head>
<body>

    <div id="menu-screen" class="menu-container">
        <h1>ROCKET RUN PRO</h1>
        <p>SELECIONE O N√çVEL DE DIFICULDADE</p>
        <button class="difficulty-button easy" onclick="startGame('easy')">F√ÅCIL</button>
        <button class="difficulty-button medium" onclick="startGame('medium')">M√âDIO</button>
        <button class="difficulty-button insane" onclick="startGame('insane')">ESTOU LOUCO (s√≥ para loucos)</button>
    </div>

    <div id="gameover-screen" class="game-over-container hidden">
        <h1>MISS√ÉO FALHOU</h1>
        <h2 id="gameover-reason"></h2>
        <div class="score-display">
            Pontua√ß√£o: <span id="final-score">0</span>
        </div>
        <div class="score-display">
            Recorde: <span id="high-score">0</span>
        </div>
        <button class="restart-button easy" onclick="showMenu()">REINICIAR</button>
    </div>

    <div id="controls-instruction">
        Controles PC: WASD ou SETAS (Mover), Clique/ESPA√áO (Impulso Extra). Controles Celular: D-Pad (Mover), Toque (Impulso Extra Cont√≠nuo).
    </div>
    
    <div id="mobile-controls">
        <div id="up-button" class="control-button" 
            ontouchstart="controlButtonDown('w')" ontouchend="controlButtonUp('w')"
            onmousedown="controlButtonDown('w')" onmouseup="controlButtonUp('w')">
            PROPULSOR
        </div>
        <div>
            <div id="left-button" class="control-button" 
                ontouchstart="controlButtonDown('a')" ontouchend="controlButtonUp('a')"
                onmousedown="controlButtonDown('a')" onmouseup="controlButtonUp('a')">
                &#9664;
            </div>
            <div id="right-button" class="control-button" 
                ontouchstart="controlButtonDown('d')" ontouchend="controlButtonUp('d')"
                onmousedown="controlButtonDown('d')" onmouseup="controlButtonUp('d')">
                &#9654;
            </div>
        </div>
        
    </div>
    <script>
        // Global (MANTIDO)
        let rocketX;
        let rocketY; 
        let rocketXVel = 0;
        let rocketYVel = 0;
        let combustivel;
        const MAX_COMBUSTIVEL = 100;
        const CONSUMO_POR_FRAME = 0.05;
        let asteroides = [];
        let score = 0;
        let gameState = 'menu'; 
        let motivoFimDeJogo = "";
        let highScore = 0;
        let estrelas = [];
        let currentDifficulty = 'easy';
        let asteroideLargura = 50;

        // NOVO: Estado para controle de clique/toque (Impulso Extra Cont√≠nuo)
        let isBoostActive = false; 

        // Vari√°veis para Mensagem Motivacional
        let messageOverlay = null;
        let messageTimer = 0;
        const MESSAGE_DURATION = 180; 
        let keys = {}; // Estado das teclas pressionadas (usado tamb√©m pelos bot√µes virtuais)

        // Vari√°veis para Autopilot (Assist√™ncia Invis√≠vel - EASY mode)
        let lastActionTime = 0; 
        let autoPilotActive = false;
        const AUTOPILOT_DELAY = 120; 

        // Vari√°veis que MUDAM por DIFICULDADE (MANTIDO)
        let gravidade;
        let asteroideAbertura; 
        let velocidadeJogo; 
        let y_thrust;
        let x_thrust;
        let max_speed;
        let drag; 

        // Lista de 40 Mensagens Motivacionais (MANTIDO)
        const MENSAGENS_MOTIVACIONAIS = [
            "Uau! Voc√™ √© um √°s da pilotagem! Avance para o pr√≥ximo setor.", 
            "Impec√°vel! Seu hist√≥rico de voo √© perfeito. Continue assim!", 
            "Setor de Meio de Jogo: Voc√™ √© impar√°vel. A lenda diz que poucos chegam aqui!", 
            "Meta de 100 atingida! A velocidade da luz n√£o √© p√°reo para voc√™.", 
            "Excelente manobra! Nem um gr√£o de poeira espacial te parou.", 
            "Lenda em forma√ß√£o! O universo inteiro assiste ao seu voo.", 
            "üöÄ Modo Turbo Ativado! Continue desviando com essa precis√£o.", 
            "Dupla Centena! Seu controle √© absoluto. Mantenha o curso!", 
            "Pilotagem n√≠vel mestre. O pr√≥ximo desafio espera!", 
            "Um Quarto do Caminho! Incr√≠vel! A recompensa est√° pr√≥xima.", 
            "A gravidade obedece a voc√™. Siga em frente, comandante!", 
            "Tr√™s Centenas! Voc√™ est√° reescrevendo as regras da f√≠sica.", 
            "Precis√£o Absoluta! Seu nome ser√° gravado nas estrelas.", 
            "Que Voo! Voc√™ nem parece precisar de combust√≠vel.", 
            "Setor Cr√≠tico Superado! Nada pode te derrubar agora.", 
            "Quatro Centenas! Voc√™ est√° voando mais r√°pido que a informa√ß√£o.", 
            "Seu foco √© lend√°rio. Continue com essa determina√ß√£o.", 
            "Mais um salto qu√¢ntico em sua pontua√ß√£o! Parab√©ns!", 
            "N√≠vel de Reflexo: Divino! Mal posso acompanhar sua velocidade.", 
            "MEIO MILH√ÉO DE PONTOS! (Meio caminho para a gl√≥ria!)", 
            "Retorno Triunfal! O universo inteiro celebra seu sucesso.", 
            "Maestria Total! Seu foguete parece deslizar no v√°cuo.", 
            "Nem mesmo um buraco negro ousaria te desafiar. Siga!", 
            "Seis Centenas! Que desempenho monumental.", 
            "Voc√™ √© um G√™nio T√°tico! Seus movimentos s√£o perfeitos.", 
            "O Painel de Controle est√° em √™xtase com sua performance.", 
            "Onde voc√™ aprendeu a voar assim? Absolutamente fabuloso!", 
            "Sete Centenas! A meta est√° logo ali, √† vista!", 
            "Pr√≥ximo N√≠vel de Consci√™ncia: Voc√™ √© a pr√≥pria estrela.", 
            "Tr√™s Quartos do Caminho! A perseveran√ßa compensa.", 
            "Lan√ßamento Bem Sucedido! Prepare-se para o final √©pico.", 
            "Oito Centenas! Os Deuses da Astrologia est√£o impressionados.", 
            "Voc√™ est√° em outra dimens√£o de pilotagem. Continue a magia!", 
            "√öltima Barreira de Setor! Voc√™ consegue ver o final?", 
            "Recorde de Velocidade Quebrado! Apenas voc√™ e o infinito.", 
            "Nove Centenas! Faltam apenas 100 para a Lenda!", 
            "Voc√™ est√° respirando no espa√ßo com facilidade! Quase l√°!", 
            "O C√©u N√£o √â o Limite! Continue ultrapassando expectativas.", 
            "PR√ìXIMA PARADA: GL√ìRIA! Apenas mais um passo...", 
            "üåü N√çVEL LEND√ÅRIO ATINGIDO! Voc√™ √© o MESTRE DO ESPA√áO! üåü" 
        ];


        const DIFICULDADE_CONFIG = {
            'easy': {
                grav: 0.1, 
                abert: 200, 
                y_thrust: -0.7, 
                x_thrust: 0.5, 
                max_speed: 4, 
                scroll_base: 2, 
                drag: 0.98, 
            },
            'medium': {
                grav: 0.4, 
                abert: 140,
                y_thrust: -1.0,
                x_thrust: 0.8,
                max_speed: 6,
                scroll_base: 4,
                drag: 0.97,
            },
            'insane': {
                grav: 0.8, 
                abert: 100, 
                y_thrust: -1.3,
                x_thrust: 1.2,
                max_speed: 8,
                scroll_base: 7,
                drag: 0.96, 
            }
        };

        // =========================================================
        // FUN√á√ïES DE SETUP E MENU
        // =========================================================

        function setup() {
            let w = min(800, windowWidth);
            let h = min(450, windowHeight);
            let canvas = createCanvas(w, h); 
            canvas.parent(document.body);

            // Previne o menu de contexto do bot√£o direito e o comportamento padr√£o no toque
            canvas.elt.addEventListener('contextmenu', e => e.preventDefault()); 
            
            let savedScore = localStorage.getItem('rocketRunHighScore');
            if (savedScore !== null) {
                highScore = parseInt(savedScore);
            }
            
            textAlign(CENTER, CENTER);
            textFont('Arial'); 
            noStroke(); 
            frameRate(60); 
            
            for(let i = 0; i < 150; i++) {
                estrelas.push({ x: random(width), y: random(height), size: random(1, 3), speed: random(0.5, 2) });
            }
            
            canvas.elt.style.display = 'none';
            // Chama a fun√ß√£o para verificar e mostrar/ocultar o D-Pad
            checkAndToggleMobileControls(); 
        }

        // NOVO: Fun√ß√£o para verificar o tipo de dispositivo e exibir os controles m√≥veis
        function checkAndToggleMobileControls() {
            const isMobile = window.matchMedia("only screen and (max-width: 760px)").matches || 
                             /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
            const mobileControls = document.getElementById('mobile-controls');
            
            if (isMobile && gameState === 'running') {
                mobileControls.classList.add('show-mobile-controls');
                document.getElementById('controls-instruction').classList.add('hidden'); // Oculta a instru√ß√£o de texto no celular
            } else {
                mobileControls.classList.remove('show-mobile-controls');
                if (gameState === 'menu' || gameState === 'gameover') {
                    document.getElementById('controls-instruction').classList.remove('hidden');
                }
            }
        }
        
        function showMenu() {
            gameState = 'menu';
            document.getElementById('menu-screen').classList.remove('hidden');
            document.getElementById('gameover-screen').classList.add('hidden');
            let canvas = select('canvas');
            if (canvas) canvas.elt.style.display = 'none';
            checkAndToggleMobileControls(); // Oculta os controles m√≥veis no menu
        }

        function startGame(difficulty) {
            currentDifficulty = difficulty;
            const config = DIFICULDADE_CONFIG[difficulty];

            gravidade = config.grav;
            asteroideAbertura = config.abert;
            y_thrust = config.y_thrust;
            x_thrust = config.x_thrust;
            max_speed = config.max_speed;
            drag = config.drag;
            
            rocketX = width / 4; 
            rocketY = height / 2;
            rocketXVel = 0;
            rocketYVel = 0;
            asteroides = [];
            score = 0;
            combustivel = MAX_COMBUSTIVEL;
            asteroides.push(new Asteroide());
            gameState = 'running';
            messageOverlay = null; 
            keys = {}; 
            isBoostActive = false; 

            lastActionTime = frameCount; 
            autoPilotActive = false;

            document.getElementById('menu-screen').classList.add('hidden');
            document.getElementById('gameover-screen').classList.add('hidden');
            document.getElementById('controls-instruction').classList.add('hidden');
            let canvas = select('canvas');
            if (canvas) canvas.elt.style.display = 'block';
            
            checkAndToggleMobileControls(); // Exibe os controles m√≥veis no jogo

            loop();
        }

        function draw() {
            if (gameState === 'menu') {
                drawBackgroundGradient(); 
                drawStars();
                return;
            }
            
            drawBackgroundGradient(); 
            drawStars(); 
            
            if (gameState === 'running') {

                // --- 1. APLICA√á√ÉO DOS CONTROLES (FOR√áAS) ---

                // Checa a condi√ß√£o de Impulso Extra (4x mais forte)
                // Se ESPA√áO (32) OU Clique/Toque (isBoostActive) estiver ativo
                const highBoostCondition = (keys[' '] || keys[32] || isBoostActive);

                if (highBoostCondition) {
                    // Impulso extra cont√≠nuo (mais forte)
                    rocketYVel += y_thrust * 4.0;
                } else if (keys['w'] || keys['W'] || keys['ArrowUp']) {
                    // Impulso padr√£o (mais fraco) se o boost n√£o estiver ativo
                    rocketYVel += y_thrust;
                }

                // Vertical (Baixo ou Seta para Baixo)
                // O bot√£o 'propulsor' substitui 'W'/'ArrowUp' e 'S'/'ArrowDown' n√£o tem bot√£o virtual
                if (keys['s'] || keys['S'] || keys['ArrowDown']) {
                    rocketYVel -= y_thrust * 0.5; 
                }

                // Horizontal (Frente/Tr√°s ou D/A)
                let rightThrustApplied = false;
                if (keys['d'] || keys['D'] || keys['ArrowRight']) {
                    rocketXVel += x_thrust;
                    rightThrustApplied = true;
                }
                if (keys['a'] || keys['A'] || keys['ArrowLeft']) {
                    rocketXVel -= x_thrust;
                }
                
                // Vari√°vel para checar se o jogador est√° fazendo QUALQUER coisa
                let anyPlayerAction = (keys['w'] || keys['W'] || keys['ArrowUp'] || keys['s'] || keys['S'] || keys['ArrowDown'] || keys['a'] || keys['A'] || rightThrustApplied || highBoostCondition);


                // --- L√ìGICA DO PILOTO AUTOM√ÅTICO (Assist√™ncia Invis√≠vel) - MANTIDA ---
                if (currentDifficulty === 'easy') {
                    
                    if (anyPlayerAction) {
                        autoPilotActive = false;
                        lastActionTime = frameCount;
                    } else {
                        if (frameCount > lastActionTime + AUTOPILOT_DELAY) {
                            autoPilotActive = true;
                        }
                    }

                    if (autoPilotActive) {
                        rocketXVel += x_thrust * 0.2; 
                    }
                }

                // --- 2. F√çSICA E ATUALIZA√á√ÉO DE VELOCIDADE (MANTIDO) ---
                
                rocketYVel += gravidade;
                rocketXVel *= drag;
                rocketYVel *= drag;

                rocketXVel = constrain(rocketXVel, -max_speed, max_speed);
                rocketYVel = constrain(rocketYVel, -max_speed, max_speed);
                
                rocketX += rocketXVel;
                rocketY += rocketYVel;

                rocketX = constrain(rocketX, 15, width - 15);
                rocketY = constrain(rocketY, 15, height - 15);
                
                // --- 3. MOVIMENTO DO MUNDO (MANTIDO) ---
                
                let xFactor = map(rocketX, width / 4, width - 15, 0, 1.5); 
                velocidadeJogo = DIFICULDADE_CONFIG[currentDifficulty].scroll_base + xFactor;

                // GEST√ÉO DO COMBUST√çVEL
                let currentConsumption = CONSUMO_POR_FRAME * (anyPlayerAction ? 2 : 1);

                combustivel -= currentConsumption;
                combustivel = constrain(combustivel, 0, MAX_COMBUSTIVEL); 
                
                if (combustivel <= 0) {
                    endGame("ACABOU O COMBUST√çVEL!");
                    return; 
                }
                
                // --- 4. L√ìGICA DE ASTEROIDES E COLIS√ÉO (MANTIDO) ---

                desenharFoguete(rocketX, rocketY, 30);
                
                for (let i = asteroides.length - 1; i >= 0; i--) {
                    asteroides[i].mover(velocidadeJogo);
                    asteroides[i].desenhar();

                    if (asteroides[i].checkCollision(rocketX, rocketY, 15)) { 
                        endGame("COLIS√ÉO COM ASTEROIDE!");
                    }

                    if (asteroides[i].x < -asteroideLargura) {
                        asteroides.splice(i, 1);
                    }
                    
                    // L√ìGICA DE PONTUA√á√ÉO
                    if (!asteroides[i].scored && rocketX > asteroides[i].x + asteroideLargura) {
                        score++; 
                        combustivel = MAX_COMBUSTIVEL; 
                        asteroides[i].scored = true; 
                        
                        // L√≥gica de Mensagens Motivacionais
                        if (score > 0 && score % 25 === 0 && score <= 1000) {
                            let index = (score / 25) - 1;
                            if (index < MENSAGENS_MOTIVACIONAIS.length) {
                                messageOverlay = MENSAGENS_MOTIVACIONAIS[index];
                                messageTimer = MESSAGE_DURATION;
                            }
                        }
                    }
                }

                // Gera novos asteroides
                let spawnInterval = max(30, 100 - (velocidadeJogo * 5)); 
                if (frameCount % floor(spawnInterval) === 0) { 
                    asteroides.push(new Asteroide());
                }

                drawHUD();

            } else if (gameState === 'gameover') {
                desenharFoguete(rocketX, rocketY, 30);
                drawHUD();
            }

            if (messageOverlay !== null) {
                drawMessageOverlay();
            }
        }

        // =========================================================
        // FUN√á√ïES DE INPUT (MODIFICADAS)
        // =========================================================

        // NOVO: Fun√ß√µes para simular keypress usando os bot√µes HTML
        function controlButtonDown(keyName) {
            if (gameState === 'running') {
                // Mapeia o nome da tecla para o objeto 'keys'
                keys[keyName] = true; 
                // Evita que o toque no bot√£o ative o impulso extra cont√≠nuo do touchStarted
                if (keyName === 'w') { 
                    isBoostActive = false;
                }
            }
        }

        function controlButtonUp(keyName) {
            if (gameState === 'running') {
                keys[keyName] = false;
            }
        }
        
        function keyPressed() {
            if (gameState === 'running') {
                keys[key] = true;
                keys[keyCode] = true; // Para setas e ESPA√áO (32)
            } else if (gameState === 'gameover' && (key === ' ' || keyCode === 32)) {
                showMenu();
            }
        }

        function keyReleased() {
            if (gameState === 'running') {
                keys[key] = false;
                keys[keyCode] = false;
            }
        }
        
        // --- EVENTOS DE MOUSE/TOQUE ---

        function mousePressed() {
            // Verifica se o toque/clique N√ÉO foi em um dos bot√µes do D-Pad
            if (gameState === 'running' && mouseY < height) { // Checa se o clique foi dentro do canvas
                isBoostActive = true; // Inicia o impulso cont√≠nuo
            }
            if (gameState === 'gameover') {
                showMenu();
            }
        }

        function mouseReleased() {
            if (gameState === 'running') {
                isBoostActive = false; // Para o impulso cont√≠nuo
            }
        }
        
        function touchStarted() {
             // Verifica se o toque N√ÉO foi em um elemento de controle (bot√µes)
            if (gameState === 'running' && touches.length > 0 && touches[0].y < height) { 
                 // Se o toque for no canvas, ativa o boost
                isBoostActive = true; 
            }
            if (gameState === 'gameover') {
                showMenu();
            }
            return false; // Evita rolagem da p√°gina
        }

        function touchEnded() {
             if (gameState === 'running') {
                isBoostActive = false; // Para o impulso cont√≠nuo
            }
            return false;
        }


        // =========================================================
        // FUN√á√ïES DE RESPONSIVIDADE (MODIFICADAS para chamar o check)
        // =========================================================
        function windowResized() {
            let w = min(800, windowWidth);
            let h = min(450, windowHeight);
            resizeCanvas(w, h);
            let canvas = select('canvas');
            if (canvas) {
                canvas.elt.style.left = `${(windowWidth - w) / 2}px`;
                canvas.elt.style.top = `${(windowHeight - h) / 2}px`;
            }
            checkAndToggleMobileControls(); // Reajusta a exibi√ß√£o dos controles m√≥veis
        }

        // =========================================================
        // FUN√á√ïES DE JOGO, DESENHO, CLASSE ASTEROIDE (MANTIDAS)
        // =========================================================

        function endGame(motivo) {
            motivoFimDeJogo = motivo;
            gameState = 'gameover';
            
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('rocketRunHighScore', highScore);
            }
            
            noLoop(); 

            document.getElementById('gameover-reason').innerText = motivoFimDeJogo;
            document.getElementById('final-score').innerText = score;
            document.getElementById('high-score').innerText = highScore;
            document.getElementById('gameover-screen').classList.remove('hidden');
            
            checkAndToggleMobileControls(); // Oculta os controles m√≥veis no Game Over
        }
        
        function drawMessageOverlay() {
            if (messageTimer > 0) {
                push();
                let alpha = 255;
                if (messageTimer < 60) { 
                    alpha = map(messageTimer, 0, 60, 0, 255);
                } else if (messageTimer > MESSAGE_DURATION - 60) {
                    alpha = map(messageTimer, MESSAGE_DURATION - 60, MESSAGE_DURATION, 0, 255);
                }

                fill(0, 0, 0, 200);
                rect(0, height / 2 - 50, width, 100);

                textSize(28 * (width / 800));
                fill(255, 200, 0, alpha); 
                text(messageOverlay, width / 2, height / 2);
                
                messageTimer--;
                if (messageTimer <= 0) {
                    messageOverlay = null; 
                }
                pop();
            }
        }

        function drawBackgroundGradient() {
            push(); 
            for (let y = 0; y < height; y++) {
                let inter = map(y, 0, height, 0, 1);
                let c = lerpColor(color(10, 0, 20), color(50, 0, 0), inter); 
                stroke(c);
                line(0, y, width, y);
            }
            pop(); 
        }

        function drawStars() {
            push();
            fill(255);
            for (let i = 0; i < estrelas.length; i++) {
                let star = estrelas[i];
                
                star.x -= star.speed * velocidadeJogo * 0.5; 
                
                if (star.x < 0) {
                    star.x = width;
                    star.y = random(height);
                }
                
                let c = (i % 5 === 0) ? color(255, 255, 255) : color(255, 100, 0, 150);
                fill(c); 
                ellipse(star.x, star.y, star.size, star.size);
            }
            pop();
        }

        function drawHUD() {
            push();
            textSize(20 * (width / 800)); 
            fill(255, 255, 255); 
            text("FOGUETE EM FUGA: ROTA DE SOBREVIV√äNCIA", width / 2, 25);
            
            textSize(24 * (width / 800)); 
            fill(255, 200, 0); 
            text(`SCORE: ${score}`, width - 100 * (width / 800), 60);

            textSize(18 * (width / 800));
            fill(255, 255, 255);
            text(`RECORD: ${highScore}`, width - 100 * (width / 800), 90); 

            let nivel = currentDifficulty.toUpperCase();
            let corNivel;
            if (currentDifficulty === 'easy') {
                corNivel = color(100, 255, 100);
            } else if (currentDifficulty === 'medium') {
                corNivel = color(255, 255, 0);
            } else {
                corNivel = color(255, 50, 50); 
            }

            fill(corNivel);
            textSize(18 * (width / 800)); 
            text(`MODO: ${nivel}`, 100 * (width / 800), 60); 
            
            drawFuelGauge(40 * (width / 800), 90, 15, 200 * (width / 800)); 

            textSize(14 * (width / 800));
            fill(200, 200, 255);
            text(`VELOCIDADE: ${nf(velocidadeJogo, 1, 1)}`, 100 * (width / 800), 115);

            pop();
        }

        function drawFuelGauge(x, y, h, w) {
            push();
            textSize(14 * (width / 800));
            fill(255);
            text("COMBUST√çVEL", x + w/2, y - 5);
            
            fill(50);
            stroke(255); 
            strokeWeight(1);
            rect(x, y, w, h, 5); 
            
            let fuelWidth = map(combustivel, 0, MAX_COMBUSTIVEL, 0, w);
            
            let fuelColor;
            if (combustivel < 20) {
                fuelColor = color(255, 0, 0); 
            } else if (combustivel < 50) {
                fuelColor = color(255, 255, 0); 
            } else {
                fuelColor = color(0, 200, 0); 
            }
            
            noStroke(); 
            fill(fuelColor);
            rect(x + 1, y + 1, fuelWidth - 2, h - 2, 4); 
            
            pop(); 
        }

        function desenharFoguete(x, y, tamanho) {
            push();
            
            let rastroAlpha = map(combustivel, 0, MAX_COMBUSTIVEL, 50, 255);
            let trailLength = map(rocketYVel, -max_speed, max_speed, 10, 20); 
            
            let rotationAngle = map(rocketYVel, -max_speed, max_speed, radians(-20), radians(20));
            
            translate(x, y);
            rotate(rotationAngle);
            
            // Rastro de Propuls√£o (Baseado no Y, para dar a sensa√ß√£o de impulso para cima)
            if (rocketYVel < 0 || keys['w'] || keys['W'] || keys['ArrowUp'] || isBoostActive || keys[' '] || keys[32]) {
                fill(255, 150, 0, rastroAlpha); 
                ellipse(-tamanho/2 - 5, 0, 10 + random(0, 5), 15 + random(0, 10)); 
            }
            
            // Rastro Lateral (Baseado no X, para dar a sensa√ß√£o de impulso lateral)
            if (keys['a'] || keys['A'] || keys['ArrowLeft']) {
                fill(0, 200, 255, rastroAlpha * 0.5); // Azul para freio
                rect(tamanho/2 - 5, -tamanho/2, 5, tamanho);
            } else if (keys['d'] || keys['D'] || keys['ArrowRight'] || (currentDifficulty === 'easy' && autoPilotActive)) {
                fill(255, 100, 0, rastroAlpha * 0.5); // Laranja para acelera√ß√£o (inclui Autopilot no rastro)
                rect(-tamanho/2 - 5, -tamanho/2, 5, tamanho);
            }
            
            
            // Corpo do Foguete com Sombra
            noStroke();
            fill(100); 
            triangle(-tamanho/2 + 2, tamanho/2 + 2, -tamanho/2 + 2, -tamanho/2 + 2, tamanho/2 + 2, 2); 
            
            fill(180); // Cor principal
            triangle(-tamanho/2, -tamanho/2, -tamanho/2, tamanho/2, tamanho/2, 0); 
            
            // Ponta Vermelha
            fill(200, 50, 50); 
            triangle(tamanho/2, 0, tamanho/2 - 5, -5, tamanho/2 - 5, 5); 
            
            pop();
        }

        // =========================================================
        // CLASSE ASTEROIDE (MANTIDA)
        // =========================================================

        class Asteroide {
            constructor() {
                this.x = width;
                this.centroAbertura = random(asteroideAbertura / 2 + 30, height - asteroideAbertura / 2 - 30);
                this.topo = this.centroAbertura - asteroideAbertura / 2;
                this.fundo = this.centroAbertura + asteroideAbertura / 2;
                this.scored = false; 
            }

            desenhar() {
                push();
                fill(100, 100, 150, 200); // Cor dos asteroides (azul/cinza)
                noStroke();
                
                // Asteroide Superior
                rect(this.x, 0, asteroideLargura, this.topo);
                
                // Asteroide Inferior
                rect(this.x, this.fundo, asteroideLargura, height - this.fundo);
                
                // Detalhe de Neon no Borda
                fill(50, 50, 100, 150);
                rect(this.x + asteroideLargura - 5, 0, 5, this.topo);
                rect(this.x + asteroideLargura - 5, this.fundo, 5, height - this.fundo);

                pop();
            }

            mover(velocidade) {
                this.x -= velocidade; 
            }

            checkCollision(fx, fy, fr) {
                let rocketHitboxRadius = fr;

                // Colis√£o com o asteroide superior
                let dTop = dist(fx, fy, fx, this.topo);
                if (fx + rocketHitboxRadius > this.x && fx - rocketHitboxRadius < this.x + asteroideLargura) {
                    if (fy - rocketHitboxRadius < this.topo) {
                        // Verifica se o foguete est√° acima do limite superior e colide horizontalmente
                        if (fy - rocketHitboxRadius < this.topo) { 
                             return true;
                        }
                    }
                    // Colis√£o com o asteroide inferior
                    if (fy + rocketHitboxRadius > this.fundo) {
                        // Verifica se o foguete est√° abaixo do limite inferior e colide horizontalmente
                        if (fy + rocketHitboxRadius > this.fundo) {
                            return true;
                        }
                    }
                }
                return false;
            }
        }

    </script>
</body>
</html>
