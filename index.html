<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rocket Run Pro: Mestre do Espaço</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #0a0014;
            font-family: Arial, sans-serif;
            color: white;
            overflow: hidden;
            touch-action: none; /* Bloqueia zoom/scroll global */
        }
        canvas {
            display: block;
            border-radius: 12px;
            box-shadow: 0 0 30px rgba(255, 50, 50, 0.5);
            cursor: pointer;
            touch-action: none !important;
            position: relative;
            z-index: 50;
        }
        .menu-container, .game-over-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 30px;
            background: rgba(0, 0, 0, 0.85);
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
            text-align: center;
            z-index: 100;
            max-width: 90%;
        }
        .menu-container h1, .game-over-container h1 {
            color: #ff9900;
            margin-bottom: 25px;
            font-size: 2.2rem;
        }
        .difficulty-button, .restart-button {
            display: block;
            width: 250px;
            max-width: 90%;
            padding: 15px 20px;
            margin: 15px auto;
            border: none;
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .difficulty-button:hover, .restart-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3);
        }
        .easy { background-color: #00A389; color: white; }
        .medium { background-color: #ffc107; color: #333; }
        .insane { background-color: #F44336; color: white; }
        .game-over-container h2 {
            color: #F44336;
            margin: 15px 0;
            font-size: 1.6rem;
        }
        .score-display {
            font-size: 1.3rem;
            color: #ccc;
            margin-bottom: 15px;
        }
        .score-display span {
            color: #ffc107;
            font-size: 1.7rem;
            font-weight: bold;
        }
        .hidden { display: none; }
        #controls-instruction {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.85rem;
            z-index: 10;
            text-align: center;
            max-width: 90%;
        }
        @media (max-width: 600px) {
            .menu-container h1, .game-over-container h1 { font-size: 1.8rem; }
            .difficulty-button, .restart-button { width: 80%; font-size: 1rem; }
            #controls-instruction { font-size: 0.75rem; bottom: 10px; }
        }
    </style>
</head>
<body>
    <div id="menu-screen" class="menu-container">
        <h1>ROCKET RUN PRO</h1>
        <p>SELECIONE O NÍVEL</p>
        <button class="difficulty-button easy" onclick="startGame('easy')">FÁCIL</button>
        <button class="difficulty-button medium" onclick="startGame('medium')">MÉDIO</button>
        <button class="difficulty-button insane" onclick="startGame('insane')">LOUCO</button>
    </div>
    <div id="gameover-screen" class="game-over-container hidden">
        <h1>MISSÃO FALHOU</h1>
        <h2 id="gameover-reason"></h2>
        <div class="score-display">Pontuação: <span id="final-score">0</span></div>
        <div class="score-display">Recorde: <span id="high-score">0</span></div>
        <button class="restart-button easy" onclick="showMenu()">REINICIAR</button>
    </div>
    <div id="controls-instruction">
        Controles: WASD ou SETAS (Mover), Toque/ESPAÇO (Impulso Extra)
    </div>

    <script>
        // === VARIÁVEIS GLOBAIS ===
        let rocketX, rocketY, rocketXVel = 0, rocketYVel = 0;
        let combustivel = 100;
        const MAX_COMBUSTIVEL = 100;
        const CONSUMO_POR_FRAME = 0.05;
        let asteroides = [];
        let score = 0;
        let gameState = 'menu';
        let motivoFimDeJogo = "";
        let highScore = 0;
        let estrelas = [];
        let currentDifficulty = 'easy';
        let asteroideLargura = 50;
        let isBoostActive = false;
        let messageOverlay = null;
        let messageTimer = 0;
        const MESSAGE_DURATION = 180;
        let keys = {};
        let lastActionTime = 0;
        let autoPilotActive = false;
        const AUTOPILOT_DELAY = 120;

        const DIFICULDADE_CONFIG = {
            'easy': { grav: 0.1, abert: 200, y_thrust: -0.7, x_thrust: 0.5, max_speed: 4, scroll_base: 2, drag: 0.98 },
            'medium': { grav: 0.4, abert: 140, y_thrust: -1.0, x_thrust: 0.8, max_speed: 6, scroll_base: 4, drag: 0.97 },
            'insane': { grav: 0.8, abert: 100, y_thrust: -1.3, x_thrust: 1.2, max_speed: 8, scroll_base: 7, drag: 0.96 }
        };

        let gravidade, asteroideAbertura, y_thrust, x_thrust, max_speed, drag, velocidadeJogo;

        const MENSAGENS_MOTIVACIONAIS = [
            "Uau! Você é um ás da pilotagem! Avance para o próximo setor.",
            "Impecável! Seu histórico de voo é perfeito. Continue assim!",
            "Setor de Meio de Jogo: Você é imparável. A lenda diz que poucos chegam aqui!",
            "Meta de 100 atingida! A velocidade da luz não é páreo para você.",
            "Excelente manobra! Nem um grão de poeira espacial te parou.",
            "Lenda em formação! O universo inteiro assiste ao seu voo.",
            "Modo Turbo Ativado! Continue desviando com essa precisão.",
            "Dupla Centena! Seu controle é absoluto. Mantenha o curso!",
            "Pilotagem nível mestre. O próximo desafio espera!",
            "Um Quarto do Caminho! Incrível! A recompensa está próxima.",
            "A gravidade obedece a você. Siga em frente, comandante!",
            "Três Centenas! Você está reescrevendo as regras da física.",
            "Precisão Absoluta! Seu nome será gravado nas estrelas.",
            "Que Voo! Você nem parece precisar de combustível.",
            "Setor Crítico Superado! Nada pode te derrubar agora.",
            "Quatro Centenas! Você está voando mais rápido que a informação.",
            "Seu foco é lendário. Continue com essa determinação.",
            "Mais um salto quântico em sua pontuação! Parabéns!",
            "Nível de Reflexo: Divino! Mal posso acompanhar sua velocidade.",
            "MEIO MILHÃO DE PONTOS! (Meio caminho para a glória!)",
            "Retorno Triunfal! O universo inteiro celebra seu sucesso.",
            "Maestria Total! Seu foguete parece deslizar no vácuo.",
            "Nem mesmo um buraco negro ousaria te desafiar. Siga!",
            "Seis Centenas! Que desempenho monumental.",
            "Você é um Gênio Tático! Seus movimentos são perfeitos.",
            "O Painel de Controle está em êxtase com sua performance.",
            "Onde você aprendeu a voar assim? Absolutamente fabuloso!",
            "Sete Centenas! A meta está logo ali, à vista!",
            "Próximo Nível de Consciência: Você é a própria estrela.",
            "Três Quartos do Caminho! A perseverança compensa.",
            "Lançamento Bem Sucedido! Prepare-se para o final épico.",
            "Oito Centenas! Os Deuses da Astrologia estão impressionados.",
            "Você está em outra dimensão de pilotagem. Continue a magia!",
            "Última Barreira de Setor! Você consegue ver o final?",
            "Recorde de Velocidade Quebrado! Apenas você e o infinito.",
            "Nove Centenas! Faltam apenas 100 para a Lenda!",
            "Você está respirando no espaço com facilidade! Quase lá!",
            "O Céu Não É o Limite! Continue ultrapassando expectativas.",
            "PRÓXIMA PARADA: GLÓRIA! Apenas mais um passo...",
            "NÍVEL LENDÁRIO ATINGIDO! Você é o MESTRE DO ESPAÇO!"
        ];

        // === SETUP ===
        function setup() {
            let w = min(800, windowWidth);
            let h = min(450, windowHeight);
            let canvas = createCanvas(w, h);
            canvas.parent(document.body);
            canvas.elt.style.display = 'none';
            canvas.elt.style.touchAction = 'none';
            canvas.elt.addEventListener('touchstart', e => e.preventDefault(), { passive: false });

            let saved = localStorage.getItem('rocketRunHighScore');
            if (saved) highScore = parseInt(saved);

            textAlign(CENTER, CENTER);
            textFont('Arial');
            noStroke();
            frameRate(60);

            for (let i = 0; i < 150; i++) {
                estrelas.push({ x: random(width), y: random(height), size: random(1, 3), speed: random(0.5, 2) });
            }

            noLoop();
        }

        // === MENU ===
        function showMenu() {
            gameState = 'menu';
            document.getElementById('menu-screen').classList.remove('hidden');
            document.getElementById('gameover-screen').classList.add('hidden');
            document.getElementById('controls-instruction').classList.remove('hidden');
            select('canvas').elt.style.display = 'none';
            noLoop();
        }

        function startGame(difficulty) {
            currentDifficulty = difficulty;
            const cfg = DIFICULDADE_CONFIG[difficulty];
            gravidade = cfg.grav;
            asteroideAbertura = cfg.abert;
            y_thrust = cfg.y_thrust;
            x_thrust = cfg.x_thrust;
            max_speed = cfg.max_speed;
            drag = cfg.drag;

            rocketX = width / 4;
            rocketY = height / 2;
            rocketXVel = rocketYVel = 0;
            asteroides = [new Asteroide()];
            score = 0;
            combustivel = MAX_COMBUSTIVEL;
            gameState = 'running';
            messageOverlay = null;
            keys = {};
            isBoostActive = false;
            lastActionTime = frameCount;
            autoPilotActive = false;

            document.getElementById('menu-screen').classList.add('hidden');
            document.getElementById('gameover-screen').classList.add('hidden');
            document.getElementById('controls-instruction').classList.add('hidden');
            select('canvas').elt.style.display = 'block';

            loop();
        }

        // === DRAW ===
        function draw() {
            if (gameState === 'menu') {
                drawBackgroundGradient();
                drawStars();
                return;
            }

            drawBackgroundGradient();
            drawStars();

            if (gameState === 'running') {
                const boost = (keys[' '] || keys[32] || isBoostActive);
                if (boost) {
                    rocketYVel += y_thrust * 4;
                } else if (keys['w'] || keys['W'] || keys['ArrowUp']) {
                    rocketYVel += y_thrust;
                }
                if (keys['s'] || keys['S'] || keys['ArrowDown']) {
                    rocketYVel -= y_thrust * 0.5;
                }
                if (keys['d'] || keys['D'] || keys['ArrowRight']) {
                    rocketXVel += x_thrust;
                }
                if (keys['a'] || keys['A'] || keys['ArrowLeft']) {
                    rocketXVel -= x_thrust;
                }

                const anyAction = boost || keys['w'] || keys['W'] || keys['ArrowUp'] || keys['s'] || keys['S'] || keys['ArrowDown'] || keys['a'] || keys['A'] || keys['d'] || keys['D'] || keys['ArrowRight'] || keys['ArrowLeft'];
                if (currentDifficulty === 'easy') {
                    if (anyAction) {
                        autoPilotActive = false;
                        lastActionTime = frameCount;
                    } else if (frameCount > lastActionTime + AUTOPILOT_DELAY) {
                        autoPilotActive = true;
                    }
                    if (autoPilotActive) rocketXVel += x_thrust * 0.2;
                }

                rocketYVel += gravidade;
                rocketXVel *= drag;
                rocketYVel *= drag;
                rocketXVel = constrain(rocketXVel, -max_speed, max_speed);
                rocketYVel = constrain(rocketYVel, -max_speed, max_speed);

                rocketX += rocketXVel;
                rocketY += rocketYVel;
                rocketX = constrain(rocketX, 15, width - 15);
                rocketY = constrain(rocketY, 15, height - 15);

                const xFactor = map(rocketX, width / 4, width - 15, 0, 1.5);
                velocidadeJogo = DIFICULDADE_CONFIG[currentDifficulty].scroll_base + xFactor;

                combustivel -= CONSUMO_POR_FRAME * (anyAction ? 2 : 1);
                combustivel = constrain(combustivel, 0, MAX_COMBUSTIVEL);
                if (combustivel <= 0) {
                    endGame("ACABOU O COMBUSTÍVEL!");
                    return;
                }

                desenharFoguete(rocketX, rocketY, 30);
                for (let i = asteroides.length - 1; i >= 0; i--) {
                    asteroides[i].mover(velocidadeJogo);
                    asteroides[i].desenhar();
                    if (asteroides[i].checkCollision(rocketX, rocketY, 15)) {
                        endGame("COLISÃO COM ASTEROIDE!");
                        return;
                    }
                    if (asteroides[i].x < -asteroideLargura) {
                        asteroides.splice(i, 1);
                        continue;
                    }
                    if (!asteroides[i].scored && rocketX > asteroides[i].x + asteroideLargura) {
                        score++;
                        combustivel = MAX_COMBUSTIVEL;
                        asteroides[i].scored = true;
                        if (score % 25 === 0 && score <= 1000) {
                            const idx = (score / 25) - 1;
                            if (idx < MENSAGENS_MOTIVACIONAIS.length) {
                                messageOverlay = MENSAGENS_MOTIVACIONAIS[idx];
                                messageTimer = MESSAGE_DURATION;
                            }
                        }
                    }
                }

                const spawnInterval = max(30, 100 - velocidadeJogo * 5);
                if (frameCount % floor(spawnInterval) === 0) {
                    asteroides.push(new Asteroide());
                }

                drawHUD();
            }

            if (messageOverlay) drawMessageOverlay();
        }

        // === INPUT (TOQUE + CLIQUE + TECLADO) ===
        function keyPressed() {
            if (gameState === 'running') {
                keys[key] = true;
                keys[keyCode] = true;
            } else if (gameState === 'gameover' && (key === ' ' || keyCode === 32)) {
                showMenu();
            }
        }
        function keyReleased() {
            if (gameState === 'running') {
                keys[key] = false;
                keys[keyCode] = false;
            }
        }

        function mousePressed() {
            if (gameState === 'running') isBoostActive = true;
            else if (gameState === 'gameover') showMenu();
        }
        function mouseReleased() {
            if (gameState === 'running') isBoostActive = false;
        }

        function touchStarted() {
            if (gameState === 'running') {
                isBoostActive = true;
            } else if (gameState === 'gameover') {
                showMenu();
            }
            return false; // BLOQUEIA ZOOM/SCROLL
        }
        function touchEnded() {
            if (gameState === 'running') {
                isBoostActive = false;
            }
            return false;
        }

        // === FIM DE JOGO ===
        function endGame(motivo) {
            motivoFimDeJogo = motivo;
            gameState = 'gameover';
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('rocketRunHighScore', highScore);
            }
            noLoop();
            document.getElementById('gameover-reason').innerText = motivo;
            document.getElementById('final-score').innerText = score;
            document.getElementById('high-score').innerText = highScore;
            document.getElementById('gameover-screen').classList.remove('hidden');
        }

        // === FUNÇÕES VISUAIS ===
        function drawBackgroundGradient() {
            push();
            for (let y = 0; y < height; y++) {
                let inter = map(y, 0, height, 0, 1);
                let c = lerpColor(color(10, 0, 20), color(50, 0, 0), inter);
                stroke(c);
                line(0, y, width, y);
            }
            pop();
        }

        function drawStars() {
            push();
            fill(255);
            for (let i = 0; i < estrelas.length; i++) {
                let s = estrelas[i];
                s.x -= s.speed * velocidadeJogo * 0.5;
                if (s.x < 0) {
                    s.x = width;
                    s.y = random(height);
                }
                fill(i % 5 === 0 ? 255 : color(255, 100, 0, 150));
                ellipse(s.x, s.y, s.size);
            }
            pop();
        }

        function drawHUD() {
            push();
            textSize(20 * (width / 800));
            fill(255);
            text("FOGUETE EM FUGA: ROTA DE SOBREVIVÊNCIA", width / 2, 25);
            textSize(24 * (width / 800));
            fill(255, 200, 0);
            text(`SCORE: ${score}`, width - 100 * (width / 800), 60);
            textSize(18 * (width / 800));
            fill(255);
            text(`RECORD: ${highScore}`, width - 100 * (width / 800), 90);

            let corNivel = currentDifficulty === 'easy' ? color(100, 255, 100) : 
                          currentDifficulty === 'medium' ? color(255, 255, 0) : color(255, 50, 50);
            fill(corNivel);
            textSize(18 * (width / 800));
            text(`MODO: ${currentDifficulty.toUpperCase()}`, 100 * (width / 800), 60);

            drawFuelGauge(40 * (width / 800), 90, 15, 200 * (width / 800));
            textSize(14 * (width / 800));
            fill(200, 200, 255);
            text(`VELOCIDADE: ${nf(velocidadeJogo, 1, 1)}`, 100 * (width / 800), 115);
            pop();
        }

        function drawFuelGauge(x, y, h, w) {
            push();
            textSize(14 * (width / 800));
            fill(255);
            text("COMBUSTÍVEL", x + w/2, y - 5);
            fill(50);
            stroke(255);
            strokeWeight(1);
            rect(x, y, w, h, 5);
            let fuelW = map(combustivel, 0, MAX_COMBUSTIVEL, 0, w);
            fill(combustivel < 20 ? color(255,0,0) : combustivel < 50 ? color(255,255,0) : color(0,200,0));
            noStroke();
            rect(x + 1, y + 1, fuelW - 2, h - 2, 4);
            pop();
        }

        function desenharFoguete(x, y, t) {
            push();
            let alpha = map(combustivel, 0, MAX_COMBUSTIVEL, 50, 255);
            let ang = map(rocketYVel, -max_speed, max_speed, radians(-20), radians(20));
            translate(x, y);
            rotate(ang);

            if (rocketYVel < 0 || keys['w'] || keys['W'] || keys['ArrowUp'] || isBoostActive || keys[' '] || keys[32]) {
                fill(255, 150, 0, alpha);
                ellipse(-t/2 - 5, 0, 10 + random(5), 15 + random(10));
            }

            if (keys['a'] || keys['A'] || keys['ArrowLeft']) {
                fill(0, 200, 255, alpha * 0.5);
                rect(t/2 - 5, -t/2, 5, t);
            } else if (keys['d'] || keys['D'] || keys['ArrowRight'] || (currentDifficulty === 'easy' && autoPilotActive)) {
                fill(255, 100, 0, alpha * 0.5);
                rect(-t/2 - 5, -t/2, 5, t);
            }

            noStroke();
            fill(100);
            triangle(-t/2 + 2, t/2 + 2, -t/2 + 2, -t/2 + 2, t/2 + 2, 2);
            fill(180);
            triangle(-t/2, -t/2, -t/2, t/2, t/2, 0);
            fill(200, 50, 50);
            triangle(t/2, 0, t/2 - 5, -5, t/2 - 5, 5);
            pop();
        }

        function drawMessageOverlay() {
            if (messageTimer > 0) {
                push();
                let alpha = 255;
                if (messageTimer < 60) alpha = map(messageTimer, 0, 60, 0, 255);
                else if (messageTimer > MESSAGE_DURATION - 60) alpha = map(messageTimer, MESSAGE_DURATION - 60, MESSAGE_DURATION, 0, 255);
                fill(0, 0, 0, 200);
                rect(0, height / 2 - 50, width, 100);
                textSize(28 * (width / 800));
                fill(255, 200, 0, alpha);
                text(messageOverlay, width / 2, height / 2);
                messageTimer--;
                if (messageTimer <= 0) messageOverlay = null;
                pop();
            }
        }

        class Asteroide {
            constructor() {
                this.x = width;
                this.centroAbertura = random(asteroideAbertura / 2 + 30, height - asteroideAbertura / 2 - 30);
                this.topo = this.centroAbertura - asteroideAbertura / 2;
                this.fundo = this.centroAbertura + asteroideAbertura / 2;
                this.scored = false;
            }
            desenhar() {
                push();
                fill(100, 100, 100);
                rect(this.x, 0, asteroideLargura, this.topo);
                fill(150, 150, 150, 100);
                rect(this.x, 0, asteroideLargura, this.topo/4);
                fill(100, 100, 100);
                rect(this.x, this.fundo, asteroideLargura, height - this.fundo);
                fill(150, 150, 150, 100);
                rect(this.x, this.fundo, asteroideLargura, (height - this.fundo)/4);
                pop();
            }
            mover(v) { this.x -= v; }
            checkCollision(rx, ry, rr) {
                const rL = rx - rr, rR = rx + rr, rT = ry - rr, rB = ry + rr;
                const xCol = rR > this.x && rL < this.x + asteroideLargura;
                return xCol && (rT < this.topo || rB > this.fundo);
            }
        }

        function windowResized() {
            let w = min(800, windowWidth);
            let h = min(450, windowHeight);
            resizeCanvas(w, h);
        }
    </script>
</body>
</html>
