<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rocket Run Pro: Mestre do Espaço</title>
    <!-- P5.JS 1.9.4 - CORRIGE BUGS DE TOUCH NO ANDROID -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.4/p5.js"></script>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            background: #0a0014;
            overflow: hidden;
            touch-action: none;
            user-select: none;
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        canvas {
            border-radius: 12px;
            box-shadow: 0 0 30px rgba(255,50,50,0.5);
            touch-action: none;
        }
        #menu, #gameover {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            z-index: 100;
            color: white;
        }
        #menu h1, #gameover h1 { color: #ff9900; font-size: 2.5rem; margin-bottom: 20px; }
        .btn {
            display: block;
            width: 260px;
            margin: 12px auto;
            padding: 16px;
            font-size: 1.2rem;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: 0.2s;
        }
        .btn:active { transform: scale(0.98); }
        .easy { background: #00A389; color: white; }
        .medium { background: #ffc107; color: #333; }
        .insane { background: #F44336; color: white; }
        #gameover h2 { color: #F44336; margin: 15px 0; }
        .score { color: #ccc; font-size: 1.3rem; margin: 10px 0; }
        .score span { color: #ffc107; font-size: 1.6rem; font-weight: bold; }
        .hidden { display: none; }
        #hint {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1.1rem;
            color: #ffcc00;
            z-index: 10;
        }
    </style>
</head>
<body>

<!-- MENU -->
<div id="menu">
    <h1>ROCKET RUN PRO</h1>
    <p>TOQUE NA TELA PARA SUBIR</p>
    <button class="btn easy" onclick="start('easy')">FÁCIL</button>
    <button class="btn medium" onclick="start('medium')">MÉDIO</button>
    <button class="btn insane" onclick="start('insane')">LOCO</button>
</div>

<!-- GAME OVER -->
<div id="gameover" class="hidden">
    <h1>MISSÃO FALHOU</h1>
    <h2 id="reason"></h2>
    <div class="score">Pontuação: <span id="final">0</span></div>
    <div class="score">Recorde: <span id="best">0</span></div>
    <button class="btn easy" onclick="showMenu()">REINICIAR</button>
</div>

<div id="hint">TOQUE NA TELA PARA SUBIR</div>

<script>
    // === CONFIGURAÇÕES ===
    let canvas, rocket = {}, fuel = 100, score = 0, high = 0, asteroids = [], stars = [];
    let state = 'menu', diff = 'easy', thrustActive = false;
    let g, gap, thrust, xth, max, speed, drag;

    const CFG = {
        easy:   {g:0.1, gap:200, thrust:-0.7, xth:0.5, max:4, speed:2, drag:0.98},
        medium: {g:0.4, gap:140, thrust:-1.0, xth:0.8, max:6, speed:4, drag:0.97},
        insane: {g:0.8, gap:100, thrust:-1.3, xth:1.2, max:8, speed:7, drag:0.96}
    };

    // === INICIAR JOGO ===
    function start(d) {
        diff = d;
        const c = CFG[d];
        g = c.g; gap = c.gap; thrust = c.thrust; xth = c.xth; max = c.max; speed = c.speed; drag = c.drag;

        let w = Math.min(800, windowWidth - 20);
        let h = Math.min(450, windowHeight - 100);
        canvas = createCanvas(w, h);
        canvas.parent(document.body);

        rocket = { x: w/4, y: h/2, vx: 0, vy: 0 };
        fuel = 100; score = 0; asteroids = [new Asteroid()];
        for (let i = 0; i < 150; i++) stars.push({ x: random(w), y: random(h), s: random(1,3), v: random(0.5,2) });

        document.getElementById('menu').classList.add('hidden');
        document.getElementById('hint').classList.add('hidden');
        state = 'play';
        loop();
    }

    // === SETUP ===
    function setup() {
        noLoop();
        high = parseInt(localStorage.getItem('rrhs') || 0);
    }

    // === LOOP PRINCIPAL ===
    function draw() {
        if (state !== 'play') return;

        background(10, 0, 20);
        drawStars();

        // === TOQUE / CLIQUE ===
        thrustActive = mouseIsPressed || (touches && touches.length > 0);

        // === FÍSICA ===
        if (thrustActive) rocket.vy += thrust * 3.5;
        rocket.vy += g;
        rocket.vx *= drag; rocket.vy *= drag;
        rocket.vx = constrain(rocket.vx, -max, max);
        rocket.vy = constrain(rocket.vy, -max, max);
        rocket.x += rocket.vx; rocket.y += rocket.vy;
        rocket.x = constrain(rocket.x, 20, width - 20);
        rocket.y = constrain(rocket.y, 20, height - 20);

        fuel -= 0.05 * (thrustActive ? 2 : 1);
        if (fuel <= 0) end("SEM COMBUSTÍVEL");

        drawRocket();
        updateAsteroids();
        drawHUD();
    }

    // === DESENHO DO FOGUETE ===
    function drawRocket() {
        push();
        translate(rocket.x, rocket.y);
        rotate(map(rocket.vy, -max, max, -0.3, 0.3));
        if (thrustActive) { fill(255,150,0,220); ellipse(-22,0,16,28); }
        fill(180); triangle(-16,-16,-16,16,16,0);
        fill(200,50,50); triangle(16,0,10,-6,10,6);
        pop();
    }

    // === ESTRELAS ===
    function drawStars() {
        fill(255);
        for (let s of stars) {
            s.x -= s.v * speed * 0.5;
            if (s.x < 0) s.x = width;
            ellipse(s.x, s.y, s.s);
        }
    }

    // === ASTEROIDES ===
    function updateAsteroids() {
        for (let i = asteroids.length - 1; i >= 0; i--) {
            let a = asteroids[i];
            a.x -= speed;
            fill(100,50,50); stroke(200,50,50); strokeWeight(2);
            rect(a.x, 0, 50, a.top);
            rect(a.x, a.bottom, 50, height - a.bottom);

            if (dist(rocket.x, rocket.y, a.x + 25, a.center) < 40 && (rocket.y < a.top || rocket.y > a.bottom)) {
                end("COLISÃO!");
            }
            if (a.x < -60) {
                score++; fuel = 100;
                asteroids.splice(i, 1);
                asteroids.push(new Asteroid());
            }
        }
    }

    // === HUD ===
    function drawHUD() {
        fill(255); textSize(20); textAlign(LEFT);
        text(`SCORE: ${score}`, 20, 30);
        text(`REC: ${high}`, 20, 60);
        fill(0,200,0); rect(20, 80, map(fuel,0,100,0,200), 15);
    }

    // === FIM DE JOGO ===
    function end(msg) {
        state = 'over';
        if (score > high) { high = score; localStorage.setItem('rrhs', high); }
        noLoop();
        document.getElementById('reason').innerText = msg;
        document.getElementById('final').innerText = score;
        document.getElementById('best').innerText = high;
        document.getElementById('gameover').classList.remove('hidden');
    }

    function showMenu() {
        document.getElementById('gameover').classList.add('hidden');
        document.getElementById('menu').classList.remove('hidden');
        document.getElementById('hint').classList.remove('hidden');
        state = 'menu';
    }

    // === CLASSE ASTEROIDE ===
    class Asteroid {
        constructor() {
            this.center = random(100, height - 100);
            this.gap = gap / 2;
            this.top = this.center - this.gap;
            this.bottom = this.center + this.gap;
            this.x = width;
        }
    }

    // === EVENTOS DE TOQUE (100% FUNCIONAIS NO CELULAR) ===
    function touchStarted() { if (state === 'play') thrustActive = true; return false; }
    function touchEnded() { if (state === 'play') thrustActive = false; return false; }
    function mousePressed() { return touchStarted(); }
    function mouseReleased() { return touchEnded(); }

    // === PREVENIR ZOOM/SCROLL NO CELULAR ===
    document.addEventListener('touchstart', e => e.preventDefault(), { passive: false });
    document.addEventListener('touchmove', e => e.preventDefault(), { passive: false });
    document.addEventListener('contextmenu', e => e.preventDefault());
</script>
</body>
</html>
