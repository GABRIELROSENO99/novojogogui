<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rocket Run Pro: Mestre do Espaço</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #0a0014;
            font-family: Arial, sans-serif;
            color: white;
            overflow: hidden;
        }
        canvas {
            display: block;
            border-radius: 12px;
            box-shadow: 0 0 30px rgba(255, 50, 50, 0.5);
            cursor: pointer;
        }
        .menu-container, .game-over-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 30px;
            background: rgba(0, 0, 0, 0.85);
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
            text-align: center;
            z-index: 100;
        }
        .menu-container h1, .game-over-container h1 {
            color: #ff9900;
            margin-bottom: 25px;
            font-size: 2.5rem;
        }
        .difficulty-button, .restart-button {
            display: block;
            width: 250px;
            padding: 15px 20px;
            margin: 15px auto;
            border: none;
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .difficulty-button:hover, .restart-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3);
        }
        .easy { background-color: #00A389; color: white; }
        .medium { background-color: #ffc107; color: #333; }
        .insane { background-color: #F44336; color: white; }
        .game-over-container h2 {
            color: #F44336;
            margin: 15px 0;
            font-size: 1.8rem;
        }
        .score-display {
            font-size: 1.4rem;
            color: #ccc;
            margin-bottom: 20px;
        }
        .score-display span {
            color: #ffc107;
            font-size: 1.8rem;
            font-weight: bold;
        }
        .hidden {
            display: none;
        }
        #controls-instruction {
            position: absolute;
            bottom: 20px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            z-index: 10;
        }
    </style>
</head>
<body>
    <div id="menu-screen" class="menu-container">
        <h1>ROCKET RUN PRO</h1>
        <p>SELECIONE O NÍVEL DE DIFICULDADE</p>
        <button class="difficulty-button easy" onclick="startGame('easy')">FÁCIL</button>
        <button class="difficulty-button medium" onclick="startGame('medium')">MÉDIO</button>
        <button class="difficulty-button insane" onclick="startGame('insane')">ESTOU LOUCO (só para loucos)</button>
    </div>
    <div id="gameover-screen" class="game-over-container hidden">
        <h1>MISSÃO FALHOU</h1>
        <h2 id="gameover-reason"></h2>
        <div class="score-display">
            Pontuação: <span id="final-score">0</span>
        </div>
        <div class="score-display">
            Recorde: <span id="high-score">0</span>
        </div>
        <button class="restart-button easy" onclick="showMenu()">REINICIAR</button>
    </div>
    <div id="controls-instruction">
        Toque na tela para subir (celular) | WASD/setas/espaço (PC)
    </div>

    <script>
        // Global (mantido idêntico)
        let rocketX;
        let rocketY; 
        let rocketXVel = 0;
        let rocketYVel = 0;
        let combustivel;
        const MAX_COMBUSTIVEL = 100;
        const CONSUMO_POR_FRAME = 0.05;
        let asteroides = [];
        let score = 0;
        let gameState = 'menu';
        let motivoFimDeJogo = "";
        let highScore = 0;
        let estrelas = [];
        let currentDifficulty = 'easy';
        let asteroideLargura = 50;
        let isBoostActive = false;
        let messageOverlay = null;
        let messageTimer = 0;
        const MESSAGE_DURATION = 180;
        let keys = {};
        let lastActionTime = 0;
        let autoPilotActive = false;
        const AUTOPILOT_DELAY = 120;
        let gravidade;
        let asteroideAbertura;
        let velocidadeJogo;
        let y_thrust;
        let x_thrust;
        let max_speed;
        let drag;

        const MENSAGENS_MOTIVACIONAIS = [
            "Uau! Você é um ás da pilotagem! Avance para o próximo setor.",
            "Impecável! Seu histórico de voo é perfeito. Continue assim!",
            "Setor de Meio de Jogo: Você é imparável. A lenda diz que poucos chegam aqui!",
            "Meta de 100 atingida! A velocidade da luz não é páreo para você.",
            "Excelente manobra! Nem um grão de poeira espacial te parou.",
            "Lenda em formação! O universo inteiro assiste ao seu voo.",
            "Modo Turbo Ativado! Continue desviando com essa precisão.",
            "Dupla Centena! Seu controle é absoluto. Mantenha o curso!",
            "Pilotagem nível mestre. O próximo desafio espera!",
            "Um Quarto do Caminho! Incrível! A recompensa está próxima.",
            "A gravidade obedece a você. Siga em frente, comandante!",
            "Três Centenas! Você está reescrevendo as regras da física.",
            "Precisão Absoluta! Seu nome será gravado nas estrelas.",
            "Que Voo! Você nem parece precisar de combustível.",
            "Setor Crítico Superado! Nada pode te derrubar agora.",
            "Quatro Centenas! Você está voando mais rápido que a informação.",
            "Seu foco é lendário. Continue com essa determinação.",
            "Mais um salto quântico em sua pontuação! Parabéns!",
            "Nível de Reflexo: Divino! Mal posso acompanhar sua velocidade.",
            "MEIO MILHÃO DE PONTOS! (Meio caminho para a glória!)",
            "Retorno Triunfal! O universo inteiro celebra seu sucesso.",
            "Maestria Total! Seu foguete parece deslizar no vácuo.",
            "Nem mesmo um buraco negro ousaria te desafiar. Siga!",
            "Seis Centenas! Que desempenho monumental.",
            "Você é um Gênio Tático! Seus movimentos são perfeitos.",
            "O Painel de Controle está em êxtase com sua performance.",
            "Onde você aprendeu a voar assim? Absolutamente fabuloso!",
            "Sete Centenas! A meta está logo ali, à vista!",
            "Próximo Nível de Consciência: Você é a própria estrela.",
            "Três Quartos do Caminho! A perseverança compensa.",
            "Lançamento Bem Sucedido! Prepare-se para o final épico.",
            "Oito Centenas! Os Deuses da Astrologia estão impressionados.",
            "Você está em outra dimensão de pilotagem. Continue a magia!",
            "Última Barreira de Setor! Você consegue ver o final?",
            "Recorde de Velocidade Quebrado! Apenas você e o infinito.",
            "Nove Centenas! Faltam apenas 100 para a Lenda!",
            "Você está respirando no espaço com facilidade! Quase lá!",
            "O Céu Não É o Limite! Continue ultrapassando expectativas.",
            "PRÓXIMA PARADA: GLÓRIA! Apenas mais um passo...",
            "NÍVEL LENDÁRIO ATINGIDO! Você é o MESTRE DO ESPAÇO!"
        ];

        const DIFICULDADE_CONFIG = {
            'easy': { grav: 0.1, abert: 200, y_thrust: -0.7, x_thrust: 0.5, max_speed: 4, scroll_base: 2, drag: 0.98 },
            'medium': { grav: 0.4, abert: 140, y_thrust: -1.0, x_thrust: 0.8, max_speed: 6, scroll_base: 4, drag: 0.97 },
            'insane': { grav: 0.8, abert: 100, y_thrust: -1.3, x_thrust: 1.2, max_speed: 8, scroll_base: 7, drag: 0.96 }
        };

        function setup() {
            let w = min(800, windowWidth);
            let h = min(450, windowHeight);
            let canvas = createCanvas(w, h);
            canvas.parent(document.body);
            canvas.elt.addEventListener('contextmenu', e => e.preventDefault());

            let savedScore = localStorage.getItem('rocketRunHighScore');
            if (savedScore !== null) highScore = parseInt(savedScore);

            textAlign(CENTER, CENTER);
            textFont('Arial');
            noStroke();
            frameRate(60);

            for (let i = 0; i < 150; i++) {
                estrelas.push({ x: random(width), y: random(height), size: random(1, 3), speed: random(0.5, 2) });
            }

            canvas.elt.style.display = 'none';
        }

        function showMenu() {
            gameState = 'menu';
            document.getElementById('menu-screen').classList.remove('hidden');
            document.getElementById('gameover-screen').classList.add('hidden');
            document.getElementById('controls-instruction').classList.remove('hidden');
            let canvas = select('canvas');
            if (canvas) canvas.elt.style.display = 'none';
        }

        function startGame(difficulty) {
            currentDifficulty = difficulty;
            const config = DIFICULDADE_CONFIG[difficulty];
            gravidade = config.grav;
            asteroideAbertura = config.abert;
            y_thrust = config.y_thrust;
            x_thrust = config.x_thrust;
            max_speed = config.max_speed;
            drag = config.drag;

            rocketX = width / 4;
            rocketY = height / 2;
            rocketXVel = 0;
            rocketYVel = 0;
            asteroides = [];
            score = 0;
            combustivel = MAX_COMBUSTIVEL;
            asteroides.push(new Asteroide());
            gameState = 'running';
            messageOverlay = null;
            keys = {};
            isBoostActive = false;
            lastActionTime = frameCount;
            autoPilotActive = false;

            document.getElementById('menu-screen').classList.add('hidden');
            document.getElementById('gameover-screen').classList.add('hidden');
            document.getElementById('controls-instruction').classList.add('hidden');
            let canvas = select('canvas');
            if (canvas) canvas.elt.style.display = 'block';
            loop();
        }

        function draw() {
            if (gameState === 'menu') {
                drawBackgroundGradient();
                drawStars();
                return;
            }

            drawBackgroundGradient();
            drawStars();

            if (gameState === 'running') {
                const highBoostCondition = (keys[' '] || keys[32] || isBoostActive);
                if (highBoostCondition) {
                    rocketYVel += y_thrust * 4.0;
                } else if (keys['w'] || keys['W'] || keys['ArrowUp']) {
                    rocketYVel += y_thrust;
                }
                if (keys['s'] || keys['S'] || keys['ArrowDown']) {
                    rocketYVel -= y_thrust * 0.5;
                }
                let rightThrustApplied = false;
                if (keys['d'] || keys['D'] || keys['ArrowRight']) {
                    rocketXVel += x_thrust;
                    rightThrustApplied = true;
                }
                if (keys['a'] || keys['A'] || keys['ArrowLeft']) {
                    rocketXVel -= x_thrust;
                }

                let anyPlayerAction = (keys['w'] || keys['W'] || keys['ArrowUp'] || keys['s'] || keys['S'] || keys['ArrowDown'] || keys['a'] || keys['A'] || rightThrustApplied || highBoostCondition);
                if (currentDifficulty === 'easy') {
                    if (anyPlayerAction) {
                        autoPilotActive = false;
                        lastActionTime = frameCount;
                    } else if (frameCount > lastActionTime + AUTOPILOT_DELAY) {
                        autoPilotActive = true;
                    }
                    if (autoPilotActive) {
                        rocketXVel += x_thrust * 0.2;
                    }
                }

                rocketYVel += gravidade;
                rocketXVel *= drag;
                rocketYVel *= drag;
                rocketXVel = constrain(rocketXVel, -max_speed, max_speed);
                rocketYVel = constrain(rocketYVel, -max_speed, max_speed);

                rocketX += rocketXVel;
                rocketY += rocketYVel;
                rocketX = constrain(rocketX, 15, width - 15);
                rocketY = constrain(rocketY, 15, height - 15);

                let xFactor = map(rocketX, width / 4, width - 15, 0, 1.5);
                velocidadeJogo = DIFICULDADE_CONFIG[currentDifficulty].scroll_base + xFactor;

                let currentConsumption = CONSUMO_POR_FRAME * (anyPlayerAction ? 2 : 1);
                combustivel -= currentConsumption;
                combustivel = constrain(combustivel, 0, MAX_COMBUSTIVEL);

                if (combustivel <= 0) {
                    endGame("ACABOU O COMBUSTÍVEL!");
                    return;
                }

                desenharFoguete(rocketX, rocketY, 30);

                for (let i = asteroides.length - 1; i >= 0; i--) {
                    asteroides[i].mover(velocidadeJogo);
                    asteroides[i].desenhar();
                    if (asteroides[i].checkCollision(rocketX, rocketY, 15)) {
                        endGame("COLISÃO COM ASTEROIDE!");
                    }
                    if (asteroides[i].x < -asteroideLargura) {
                        asteroides.splice(i, 1);
                    }
                    if (!asteroides[i].scored && rocketX > asteroides[i].x + asteroideLargura) {
                        score++;
                        combustivel = MAX_COMBUSTIVEL;
                        asteroides[i].scored = true;
                        if (score > 0 && score % 25 === 0 && score <= 1000) {
                            let index = (score / 25) - 1;
                            if (index < MENSAGENS_MOTIVACIONAIS.length) {
                                messageOverlay = MENSAGENS_MOTIVACIONAIS[index];
                                messageTimer = MESSAGE_DURATION;
                            }
                        }
                    }
                }

                let spawnInterval = max(30, 100 - (velocidadeJogo * 5));
                if (frameCount % floor(spawnInterval) === 0) {
                    asteroides.push(new Asteroide());
                }

                drawHUD();
            } else if (gameState === 'gameover') {
                desenharFoguete(rocketX, rocketY, 30);
                drawHUD();
            }

            if (messageOverlay !== null) {
                drawMessageOverlay();
            }
        }

        // INPUTS (SIMPLIFICADOS PARA MOBILE)
        function keyPressed() {
            if (gameState === 'running') {
                keys[key] = true;
                keys[keyCode] = true;
            } else if (gameState === 'gameover' && (key === ' ' || keyCode === 32)) {
                showMenu();
            }
        }

        function keyReleased() {
            if (gameState === 'running') {
                keys[key] = false;
                keys[keyCode] = false;
            }
        }

        // MOUSE E TOQUE UNIFICADOS (p5.js mapeia toque para mouse no Chrome Android)
        function mousePressed() {
            if (gameState === 'running') {
                isBoostActive = true;
            } else if (gameState === 'gameover') {
                showMenu();
            }
        }

        function mouseReleased() {
            if (gameState === 'running') {
                isBoostActive = false;
            }
        }

        // Toque como fallback (sem preventDefault para evitar bugs no Chrome Android)
        function touchStarted() {
            if (gameState === 'running') {
                isBoostActive = true;
            } else if (gameState === 'gameover') {
                showMenu();
            }
            // Sem return false para evitar bloqueio no Xiaomi Chrome
        }

        function touchEnded() {
            if (gameState === 'running') {
                isBoostActive = false;
            }
            // Sem return false
        }

        function windowResized() {
            let w = min(800, windowWidth);
            let h = min(450, windowHeight);
            resizeCanvas(w, h);
            let canvas = select('canvas');
            if (canvas) {
                canvas.elt.style.left = `${(windowWidth - w) / 2}px`;
                canvas.elt.style.top = `${(windowHeight - h) / 2}px`;
            }
        }

        function endGame(motivo) {
            motivoFimDeJogo = motivo;
            gameState = 'gameover';
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('rocketRunHighScore', highScore);
            }
            noLoop();
            document.getElementById('gameover-reason').innerText = motivoFimDeJogo;
            document.getElementById('final-score').innerText = score;
            document.getElementById('high-score').innerText = highScore;
            document.getElementById('gameover-screen').classList.remove('hidden');
        }

        function drawMessageOverlay() {
            if (messageTimer > 0) {
                push();
                let alpha = 255;
                if (messageTimer < 60) {
                    alpha = map(messageTimer, 0, 60, 0, 255);
                } else if (messageTimer > MESSAGE_DURATION - 60) {
                    alpha = map(messageTimer, MESSAGE_DURATION - 60, MESSAGE_DURATION, 0, 255);
                }
                fill(0, 0, 0, 200);
                rect(0, height / 2 - 50, width, 100);
                textSize(28 * (width / 800));
                fill(255, 200, 0, alpha);
                text(messageOverlay, width / 2, height / 2);
                messageTimer--;
                if (messageTimer <= 0) {
                    messageOverlay = null;
                }
                pop();
            }
        }

        function drawBackgroundGradient() {
            push();
            for (let y = 0; y < height; y++) {
                let inter = map(y, 0, height, 0, 1);
                let c = lerpColor(color(10, 0, 20), color(50, 0, 0), inter);
                stroke(c);
                line(0, y, width, y);
            }
            pop();
        }

        function drawStars() {
            push();
            fill(255);
            for (let i = 0; i < estrelas.length; i++) {
                let star = estrelas[i];
                star.x -= star.speed * velocidadeJogo * 0.5;
                if (star.x < 0) {
                    star.x = width;
                    star.y = random(height);
                }
                let c = (i % 5 === 0) ? color(255, 255, 255) : color(255, 100, 0, 150);
                fill(c);
                ellipse(star.x, star.y, star.size, star.size);
            }
            pop();
        }

        function drawHUD() {
            push();
            textSize(20 * (width / 800));
            fill(255, 255, 255);
            text("FOGUETE EM FUGA: ROTA DE SOBREVIVÊNCIA", width / 2, 25);
            textSize(24 * (width / 800));
            fill(255, 200, 0);
            text(`SCORE: ${score}`, width - 100 * (width / 800), 60);
            textSize(18 * (width / 800));
            fill(255, 255, 255);
            text(`RECORD: ${highScore}`, width - 100 * (width / 800), 90);
            let nivel = currentDifficulty.toUpperCase();
            let corNivel;
            if (currentDifficulty === 'easy') {
                corNivel = color(100, 255, 100);
            } else if (currentDifficulty === 'medium') {
                corNivel = color(255, 255, 0);
            } else {
                corNivel = color(255, 50, 50);
            }
            fill(corNivel);
            textSize(18 * (width / 800));
            text(`MODO: ${nivel}`, 100 * (width / 800), 60);
            drawFuelGauge(40 * (width / 800), 90, 15, 200 * (width / 800));
            textSize(14 * (width / 800));
            fill(200, 200, 255);
            text(`VELOCIDADE: ${nf(velocidadeJogo, 1, 1)}`, 100 * (width / 800), 115);
            pop();
        }

        function drawFuelGauge(x, y, h, w) {
            push();
            textSize(14 * (width / 800));
            fill(255);
            text("COMBUSTÍVEL", x + w/2, y - 5);
            fill(50);
            stroke(255);
            strokeWeight(1);
            rect(x, y, w, h, 5);
            let fuelWidth = map(combustivel, 0, MAX_COMBUSTIVEL, 0, w);
            let fuelColor;
            if (combustivel < 20) {
                fuelColor = color(255, 0, 0);
            } else if (combustivel < 50) {
                fuelColor = color(255, 255, 0);
            } else {
                fuelColor = color(0, 200, 0);
            }
            noStroke();
            fill(fuelColor);
            rect(x + 1, y + 1, fuelWidth - 2, h - 2, 4);
            pop();
        }

        function desenharFoguete(x, y, tamanho) {
            push();
            let rastroAlpha = map(combustivel, 0, MAX_COMBUSTIVEL, 50, 255);
            let rotationAngle = map(rocketYVel, -max_speed, max_speed, radians(-20), radians(20));
            translate(x, y);
            rotate(rotationAngle);
            if (rocketYVel < 0 || keys['w'] || keys['W'] || keys['ArrowUp'] || isBoostActive || keys[' '] || keys[32]) {
                fill(255, 150, 0, rastroAlpha);
                ellipse(-tamanho/2 - 5, 0, 10 + random(0, 5), 15 + random(0, 10));
            }
            if (keys['a'] || keys['A'] || keys['ArrowLeft']) {
                fill(0, 200, 255, rastroAlpha * 0.5);
                rect(tamanho/2 - 5, -tamanho/2, 5, tamanho);
            } else if (keys['d'] || keys['D'] || keys['ArrowRight'] || (currentDifficulty === 'easy' && autoPilotActive)) {
                fill(255, 100, 0, rastroAlpha * 0.5);
                rect(-tamanho/2 - 5, -tamanho/2, 5, tamanho);
            }
            noStroke();
            fill(100);
            triangle(-tamanho/2 + 2, tamanho/2 + 2, -tamanho/2 + 2, -tamanho/2 + 2, tamanho/2 + 2, 2);
            fill(180);
            triangle(-tamanho/2, -tamanho/2, -tamanho/2, tamanho/2, tamanho/2, 0);
            fill(200, 50, 50);
            triangle(tamanho/2, 0, tamanho/2 - 5, -5, tamanho/2 - 5, 5);
            pop();
        }

        class Asteroide {
            constructor() {
                this.x = width;
                this.centroAbertura = random(asteroideAbertura / 2 + 30, height - asteroideAbertura / 2 - 30);
                this.topo = this.centroAbertura - asteroideAbertura / 2;
                this.fundo = this.centroAbertura + asteroideAbertura / 2;
                this.scored = false;
            }
            desenhar() {
                push();
                stroke(200, 50, 50);
                strokeWeight(2);
                fill(100, 50, 50);
                rect(this.x, 0, asteroideLargura, this.topo);
                rect(this.x, this.fundo, asteroideLargura, height - this.fundo);
                pop();
            }
            mover(scrollSpeed) {
                this.x -= scrollSpeed;
            }
            checkCollision(px, py, pr) {
                if (px + pr > this.x && px - pr < this.x + asteroideLargura) {
                    if (py - pr < this.topo || py + pr > this.fundo) {
                        return true;
                    }
                }
                return false;
            }
        }
    </script>
</body>
</html>
